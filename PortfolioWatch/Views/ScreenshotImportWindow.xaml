<Window x:Class="PortfolioWatch.Views.ScreenshotImportWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:emoji="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf"
        xmlns:converters="clr-namespace:PortfolioWatch.Converters"
        mc:Ignorable="d"
        Title="Import from Screenshots" Height="600" Width="850"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource WindowBackgroundBrush}"
        Foreground="{DynamicResource PrimaryForegroundBrush}"
        KeyDown="Window_KeyDown">
    <Window.Resources>
        <converters:InverseCountToVisibilityConverter x:Key="InverseCountToVisibilityConverter"/>
        <!-- Removed local Button style to use the global one from Styles.xaml -->
    </Window.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Margin="0,0,0,15">
            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                <emoji:TextBlock Text="ðŸ“¸" FontSize="24" Margin="0,0,10,0" VerticalAlignment="Center"/>
                <TextBlock Text="Import Holdings from Screenshots" FontSize="20" FontWeight="SemiBold" VerticalAlignment="Center"/>
            </StackPanel>
            <TextBlock Text="Paste screenshots of your portfolio positions below (Ctrl+V)." TextWrapping="Wrap" Margin="0,0,0,5"/>
            <TextBlock Text="For best results, ensure screenshots capture: Account Name, Stock/Fund Name or Symbol, Share Count, and Current Value." 
                       TextWrapping="Wrap" Margin="0,0,0,5" Foreground="{DynamicResource SecondaryForegroundBrush}"/>
            <TextBlock Text="Multiple accounts will be separated into distinct new tabs." 
                       TextWrapping="Wrap" Margin="0,0,0,5" Foreground="{DynamicResource SecondaryForegroundBrush}"/>
            <TextBlock Text="âš ï¸ Warning: Be careful not to paste the same holding twice, as it will be counted double." 
                       Foreground="{DynamicResource NegativeColorBrush}" FontWeight="Bold" TextWrapping="Wrap" Margin="0,0,0,5"/>
            <TextBlock Text="ðŸ”’ Privacy Note: We process data anonymously with a model that does not keep any log or record other than what we store locally within the app, which you can delete at any time." 
                       Foreground="{DynamicResource SecondaryForegroundBrush}" FontSize="11" TextWrapping="Wrap" FontStyle="Italic"/>
        </StackPanel>

        <Grid Grid.Row="1">
            <!-- Image List -->
            <Border BorderThickness="1" BorderBrush="{DynamicResource ControlBorderBrush}" 
                    Background="{DynamicResource ControlBackgroundBrush}" CornerRadius="4" Padding="10">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <WrapPanel x:Name="ImagesPanel" Orientation="Horizontal" ItemWidth="200" ItemHeight="200"/>
                </ScrollViewer>
            </Border>
            
            <TextBlock Text="Press Ctrl+V to Paste Image" 
                       HorizontalAlignment="Center" VerticalAlignment="Center" 
                       Opacity="0.5" FontSize="16" IsHitTestVisible="False"
                       Visibility="{Binding ElementName=ImagesPanel, Path=Children.Count, Converter={StaticResource InverseCountToVisibilityConverter}}"/>
        </Grid>

        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
            <Button Content="Clear All" Click="Clear_Click" Margin="0,5,20,5"/>
            <Button Content="Cancel" IsCancel="true" Click="Cancel_Click"/>
            <Button Content="Process Screenshots" IsDefault="true" Click="Process_Click" 
                    Background="{DynamicResource AccentColorBrush}" Foreground="White" FontWeight="SemiBold"/>
        </StackPanel>
        
        <Grid x:Name="LoadingOverlay" Grid.Row="1" Background="#AA000000" Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="Processing with AI..." Foreground="White" FontSize="18" HorizontalAlignment="Center"/>
                <ProgressBar IsIndeterminate="True" Width="200" Height="4" Margin="0,10,0,0"/>
                <TextBlock x:Name="StatusText" Text="Initializing..." Foreground="#CCC" FontSize="14" Margin="0,10,0,0" HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
