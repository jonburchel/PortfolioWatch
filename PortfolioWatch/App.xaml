<Application x:Class="PortfolioWatch.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:PortfolioWatch"
             xmlns:emoji="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Themes/DarkTheme.xaml" />
                <ResourceDictionary Source="Themes/Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <ContextMenu x:Key="SharedContextMenu" x:Shared="False"
                         Style="{DynamicResource {x:Type ContextMenu}}">
                <MenuItem Style="{DynamicResource {x:Type MenuItem}}" IsCheckable="True" IsChecked="{Binding StartWithWindows, Mode=TwoWay}">
                    <MenuItem.Header>
                        <emoji:TextBlock Text="🪟 Start with Windows" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                    </MenuItem.Header>
                </MenuItem>

                <MenuItem Style="{StaticResource NoIconMenuItemStyle}">
                    <MenuItem.Header>
                        <emoji:TextBlock Text="🎨 Appearance" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                    </MenuItem.Header>
                    
                    <MenuItem Style="{DynamicResource {x:Type MenuItem}}" IsCheckable="True" IsChecked="{Binding IsSystemTheme, Mode=OneWay}" Command="{Binding SetThemeCommand}" CommandParameter="System">
                        <MenuItem.Header>
                            <emoji:TextBlock Text="💻 System" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem Style="{DynamicResource {x:Type MenuItem}}" IsCheckable="True" IsChecked="{Binding IsLightTheme, Mode=OneWay}" Command="{Binding SetThemeCommand}" CommandParameter="Light">
                        <MenuItem.Header>
                            <emoji:TextBlock Text="☀️ Light" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem Style="{DynamicResource {x:Type MenuItem}}" IsCheckable="True" IsChecked="{Binding IsDarkTheme, Mode=OneWay}" Command="{Binding SetThemeCommand}" CommandParameter="Dark">
                        <MenuItem.Header>
                            <emoji:TextBlock Text="🌙 Dark" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                        </MenuItem.Header>
                    </MenuItem>
                    
                    <Separator Style="{DynamicResource {x:Type Separator}}"/>

                    <MenuItem Style="{StaticResource NoIconMenuItemStyle}" StaysOpenOnClick="True">
                        <MenuItem.Header>
                            <Grid Width="200">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <emoji:TextBlock Text="👁️ Opacity" Foreground="{DynamicResource PrimaryForegroundBrush}" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="0.2" Maximum="1.0" Value="{Binding WindowOpacity}" 
                                        VerticalAlignment="Center" Margin="10,0,10,0"
                                        IsMoveToPointEnabled="True"/>
                                <TextBlock Grid.Column="2" Text="{Binding WindowOpacity, StringFormat=P0}" 
                                           Foreground="{DynamicResource PrimaryForegroundBrush}" 
                                           VerticalAlignment="Center" FontSize="10" Width="30" TextAlignment="Right"/>
                            </Grid>
                        </MenuItem.Header>
                    </MenuItem>

                    <MenuItem Style="{StaticResource NoIconMenuItemStyle}" StaysOpenOnClick="True">
                        <MenuItem.Header>
                            <Grid Width="230">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <emoji:TextBlock Text="🔍 Scale" Foreground="{DynamicResource PrimaryForegroundBrush}" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Minimum="0.5" Maximum="2.0" Value="{Binding UIScale}" 
                                        VerticalAlignment="Center" Margin="10,0,10,0"
                                        IsMoveToPointEnabled="True"/>
                                <TextBlock Grid.Column="2" Text="{Binding UIScale, StringFormat=P0}" 
                                           Foreground="{DynamicResource PrimaryForegroundBrush}" 
                                           VerticalAlignment="Center" FontSize="10" Width="30" TextAlignment="Right"/>
                                <Button Grid.Column="3" Command="{Binding ResetScaleCommand}" 
                                        Background="Transparent" BorderThickness="0" Margin="5,0,0,0"
                                        ToolTip="Reset Scale" Cursor="Hand">
                                    <emoji:TextBlock Text="🔄"/>
                                </Button>
                            </Grid>
                        </MenuItem.Header>
                    </MenuItem>

                    <Separator Style="{DynamicResource {x:Type Separator}}"/>

                    <MenuItem Style="{StaticResource NoIconMenuItemStyle}">
                        <MenuItem.Header>
                            <emoji:TextBlock Text="🔮 Widget decorations" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                        </MenuItem.Header>
                        <MenuItem Style="{DynamicResource {x:Type MenuItem}}" IsCheckable="True" IsChecked="{Binding ShowFloatingWindowIntradayPercent, Mode=TwoWay}" StaysOpenOnClick="True">
                            <MenuItem.Header>
                                <emoji:TextBlock Text="Show Intraday %" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                            </MenuItem.Header>
                        </MenuItem>
                        <MenuItem Style="{DynamicResource {x:Type MenuItem}}" IsCheckable="True" IsChecked="{Binding ShowFloatingWindowIntradayGraph, Mode=TwoWay}" StaysOpenOnClick="True">
                            <MenuItem.Header>
                                <emoji:TextBlock Text="Show Intraday Graph" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                            </MenuItem.Header>
                        </MenuItem>
                        <MenuItem Style="{DynamicResource {x:Type MenuItem}}" IsCheckable="True" IsChecked="{Binding ShowFloatingWindowTotalValue, Mode=TwoWay}" StaysOpenOnClick="True">
                            <MenuItem.Header>
                                <emoji:TextBlock Text="Show Total Value" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                            </MenuItem.Header>
                        </MenuItem>
                    </MenuItem>
                </MenuItem>
                
                <Separator Style="{DynamicResource {x:Type Separator}}"/>
                
                <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding OpenPortfolioCommand}">
                    <MenuItem.Header>
                        <emoji:TextBlock Text="📂 Open" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                    </MenuItem.Header>
                </MenuItem>
                
                <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding SavePortfolioCommand}">
                    <MenuItem.Header>
                        <emoji:TextBlock Text="💾 Save all tabs" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                    </MenuItem.Header>
                </MenuItem>

                <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding ImportFromScreenshotCommand}">
                    <MenuItem.Header>
                        <emoji:TextBlock Text="📸 Import from Screenshot" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                    </MenuItem.Header>
                </MenuItem>

                <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding NormalizeCurrentTabCommand}">
                    <MenuItem.Header>
                        <emoji:TextBlock Text="⚖️ Normalize current tab values" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                    </MenuItem.Header>
                </MenuItem>
                
                <Separator Style="{DynamicResource {x:Type Separator}}"/>
                
                <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding ResetCommand}">
                    <MenuItem.Header>
                        <emoji:TextBlock Text="🔄 Reset" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                    </MenuItem.Header>
                </MenuItem>
                
                <Separator Style="{DynamicResource {x:Type Separator}}"/>

                <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding CheckForUpdatesCommand}">
                    <MenuItem.Header>
                        <emoji:TextBlock Text="🆕 Check for updates" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                    </MenuItem.Header>
                </MenuItem>
                
                <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding OpenAboutCommand}">
                    <MenuItem.Header>
                        <emoji:TextBlock Text="ℹ️ About" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                    </MenuItem.Header>
                </MenuItem>

                <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding RequestFeatureCommand}">
                    <MenuItem.Header>
                        <emoji:TextBlock Text="🐛 Request a fix or feature" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                    </MenuItem.Header>
                </MenuItem>
                
                <MenuItem Style="{StaticResource NoIconMenuItemStyle}">
                    <MenuItem.Header>
                        <emoji:TextBlock Text="💖 Say thanks" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                    </MenuItem.Header>
                    <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding BuyCoffeeCommand}" CommandParameter="0">
                        <MenuItem.Header>
                            <emoji:TextBlock Text="👋 Say thanks - $0" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding BuyCoffeeCommand}" CommandParameter="1">
                        <MenuItem.Header>
                            <emoji:TextBlock Text="💧 Buy me a water - $1" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding BuyCoffeeCommand}" CommandParameter="3">
                        <MenuItem.Header>
                            <emoji:TextBlock Text="☕ Buy me a coffee - $3" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding BuyCoffeeCommand}" CommandParameter="Custom">
                        <MenuItem.Header>
                            <emoji:TextBlock Text="💸 Buy me anything you want" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                        </MenuItem.Header>
                    </MenuItem>
                </MenuItem>
                
                <MenuItem Style="{StaticResource NoIconMenuItemStyle}" Command="{Binding ExitCommand}">
                    <MenuItem.Header>
                        <emoji:TextBlock Text="🚪 Exit" Foreground="{DynamicResource PrimaryForegroundBrush}"/>
                    </MenuItem.Header>
                </MenuItem>
            </ContextMenu>
        </ResourceDictionary>
    </Application.Resources>
</Application>
